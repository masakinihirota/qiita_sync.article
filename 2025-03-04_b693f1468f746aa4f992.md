<!--
title:   1つのルールから、GitHub Copilot Agent Mode による ルール、ドキュメント DDD(Design-Driven Dvelopment) 設計駆動開発
tags:    ポエム
id:      b693f1468f746aa4f992
private: true
-->




----------------------------------------
----------------------------------------





----------------------------------------

# 

https://blog.lai.so/vibe-coding/

vibe codingはコーディングでは以下のような方針で行う

自力でコードを書こうとせずにAIに指示をするだけ
AIが提案したコードはノールックマージ
上手くいかなかったらエラーメッセージガチャを回す

## 

プロンプトを工夫 - 明確に指示するが、手間をかけすぎない！
.cursor/rules でルールを設定 - 一貫性を保つ
タスクを小さく分割
実装計画 → テスト → 実装



## 

特に設計思想や書き方系は、「違うな」と思うたびに微調整していくのをおすすめします。

Backendのライブラリや設計思想
Backendの specの書き方・実行の仕方
Frontendのライブラリや設計思想
Frontendの specの書き方・実行の仕方
Linterの基本・実行の仕方
Pull Requestの書き方
Directory構成の説明（treeで用意しておく）



----------------------------------------

# 





## 





## 





----------------------------------------

# 





## 





## 





----------------------------------------

# 





## 





## 





----------------------------------------

# 





## 





## 





----------------------------------------

# 





## 





## 





----------------------------------------

# 





## 





## 





----------------------------------------

# 





## 





## 





----------------------------------------

# 





## 





## 





----------------------------------------

# 





## 





## 





----------------------------------------

# 





## 





## 





----------------------------------------
----------------------------------------



実験: ドキュメントをMarkdownで書き、そばにおいておいたらAIはそれを読み込んでコードに反映してくれるか？
読み込んでくれるとして実際の指示のやり方は？１ファイルにまとめたほうがいいのか？などを調べます。

※公式ドキュメントを読んだほうが早いです。

GitHub Copilot in VS Code
https://code.visualstudio.com/docs/copilot/overview




3つのフォルダ(ファイル)を作成

appフォルダ
docフォルダ
ruleフォルダ(ファイル)

appにはアプリのコードを、
docフォルダはアプリの設計書を
ruleはAIへの指示書を(カスタム指示ファイル)
それぞれ書き込みます。

最初のツールはNext.jsのみ

これに対して
1つの設計書と
1つのAIルールを追加します。


# GitHub Copilot VSCode用ドキュメント

GitHub Copilot のクイック スタート - GitHub Docs
https://docs.github.com/ja/copilot/quickstart?tool=vscode

GitHub Copilotは特に
Python、JavaScript、TypeScript、Ruby、Go、C#、C++ に適しています。

GitHub Copilotが出力するコードは提案であり、決定はユーザーが行います。



GitHub Copilot のリポジトリ カスタム命令を追加する - GitHub Docs
https://docs.github.com/ja/copilot/customizing-copilot/adding-repository-custom-instructions-for-github-copilot

AIルール
カスタム命令

リポジトリのルートに .github/copilot-instructions.md という名前のファイルを作成します。

.github ディレクトリがまだ存在しない場合は作成します。

Markdown 形式で自然言語の指示をファイルに追加します。


# AIを期待通りに動かすために

.github/copilot-instructions.md ファイルに追加する指示は、ユーザーのチャット質問を補完するコンテキストすなわち関連情報を追加する、短い自己完結型の文章であることが必要です。

Copilot Chat の応答は非決定的であるため、ここで示したものとは異なる応答が返される可能性があります。

GitHub Copilot Agent ModeはGitHub Copilotの延長線上のものであり、過去 GitHub Copilotのプロンプトで有効であったものをルールに取り込んでいきます。

GitHub Copilot のプロンプトは公式のドキュメントでまとまって載っています。

Copilot は、ユーザーが何をしているか、どのような支援を求めているかを把握するのに十分なコンテキストがある場合に最も効果的に機能します。

特定のプログラミング タスクについて支援を求めるときに同僚にコンテキストを提供するのと同じように、Copilot でも同じことができます。

## コード

Copilotにコンテキストを提供する
Copilot は、ユーザーが何をしているか、どのような支援を求めているかを把握するのに十分なコンテキストがある場合に最も効果的に機能します。特定のプログラミング タスクについて支援を求めるときに同僚にコンテキストを提供するのと同じように、Copilot でも同じことができます。

ファイルを開く
コード補完では、Copilot はエディター内の現在のファイルと開いているファイルを調べてコンテキストを分析し、適切な提案を作成します。Copilot の使用中に VS Code で関連ファイルを開いていると、このコンテキストが設定され、Copilot がプロジェクトの全体像を把握しやすくなります。

トップレベルのコメント
同僚に簡潔で概要的な自己紹介をするのと同じように、作業中のファイルにトップレベルのコメントを記述しておくと、Copilot が作成中の作品の全体的なコンテキストを理解するのに役立ちます。

小さなサンプルコード
例えばNext.jsのAPIにHonoを使いたい時は、Honoのサンプルコードを貼り付けて、
Honoを使うように指示します。

Copilotを上手に使うためには、

どんな処理をするのか、Copilotにしっかり伝えること。
どんなコードが欲しいのか、Copilotに具体的に示すこと。
いつも同じように、質の高いコードを書くこと。


大きなタスクは小さく分割します。

例えば、「TypeScriptとPugを使ったExpressアプリを作って、MongoDBから商品データを取得する商品ページも作って」なんて、一度に全部頼むのはダメです。

まず、「TypeScriptとPugを使ったExpressアプリを作って」と頼む。
次に、「商品ページを追加して」と頼む。
最後に、「データベースから顧客データを取得して」と頼む。

GitHub Copilotがすでに結果を受け入れている場合でも、後でいつでも Copilot にコードを変更するように依頼できます。
後から決めたルールが有効になります。

VSCodeのワークスペースの設定ファイル
.vscodeフォルダを作ります。
これはプロジェクトごとに作成することが出来ます。
(VSCode自身の設定ファイルとは別のファイルです。)

.vscodeフォルダ医に入れられる設定ファイル
	settings.json（ワークスペース設定）
	launch.json（デバッグ設定）
	tasks.json（タスク設定）
	extensions.json (拡張機能推奨設定):
	code-snippets (コードスニペット):
		my-snippets.code-snippets

githubのpushしてあると
Copilot はコードベース全体を非常に高速に検索できます。

コードが2500ファイル以上ある場合はリモートインデックスを構築したほうが良いです。リモートを使えない場合は、ローカルでインデックスを構築します。ただしこれは2500ファイル以下にしたほうがいいです。

プロジェクトにインデックス可能なファイルが 750 個未満の場合、Copilot は高度なローカル インデックスを自動的に構築します。750 から 2500 個のファイルがあるプロジェクトの場合は、ローカル ワークスペース インデックスの構築コマンドを実行してインデックス作成を開始できます。このコマンドは 1 回だけ実行する必要があります。



インデックスのビルド方法
VSCode で ctrl shift pから
Build remote Workspace index
Build local Workspace index


# @workspace の使用に関するヒント

はい、`@workspace` を効果的に使うためのヒントを日本語で箇条書きにまとめます。

`@workspace` を活用するヒント

具体的かつ詳細な質問をする

「これは何をするのか？」のような曖昧な質問は避け、「この関数の役割は？」「このクラスの目的は？」のように具体的に質問する。
コードやドキュメントに現れる可能性のある用語や概念を質問に含める

コード内で使用されている変数名、関数名、クラス名などを積極的に質問に含める。
回答の「使用された参照」を開発者が確認し、関連性を検証、確認する
※GitHub Copilotが関連性の低いものを参照している可能性があります。

回答で参照されたファイルが適切かどうかを確認し、必要に応じて質問を修正する。
コードの選択やチャット変数（`#editor`、`#selection`、`#file`）を使用して、関連するコンテキストを明示的に含める

質問をする前に、関連するコードを選択した状態で質問をする。
複数の参照から情報を引き出す質問をする

「catchブロックのない例外を見つける」「handleErrorがどのように呼び出されるかの例を提供する」のように質問する。
ただし、「この関数は何回呼び出されたか？」「プロジェクト内のすべてのバグを修正する」のような、コードベース全体の包括的な分析を期待しない。

現時点ではコードの範囲を超えた情報を想定しない

「このファイルに誰が貢献したか？」「このフォルダのレビューコメントを要約する」のような質問は避ける。





## テスト

関数事に単体テストを生成します。成功と失敗の両方を検証し、エッジ ケースを含めます。



# AIが期待通りには動かないルール作成 失敗例

次のような種類の指示は、期待したとおりに作動する可能性が低く、Copilot の他の領域で問題が発生する可能性があります。

* 応答を作成するときに外部リソースを参照するという要求
* 特定のスタイルで回答するという指示
* 常に特定の詳細レベルで応答するという要求

したがって、次の指示では意図した結果が得られない可能性が高いです。

* コードを生成するときは、常にmy-org/my-repoリポジトリのstyleguide.mdで定義されているコーディングスタイルに従いましょう。

* Git に関する質問に答えるときは @terminal を使いましょう。

* すべての質問には、友好的な同僚のスタイルで、くだけた言葉を使って答えましょう。
* すべての質問に、1000文字以内、12文字以内で答えること。











# GitHub Copilot Agent Mode

GitHub Copilot Agent Mode が試験的にリリースされました。

GitHub Copilot Agent Modeの簡単な解説

👇️歴代 GitHub Copilot シリーズ (個人オンリー)
GitHub Copilot
GitHub Copilot Chat
GitHub Copilot CLI
GitHub Copilot Edits
GitHub Copilot Agent Mode

それぞれの簡単な解説
GitHub Copilot でコードの提案をしてくれるようになりました。
GitHub Copilot Chat ソースコード上で会話するように指示が出来るようになりました。
GitHub Copilot CLI VSCodeのターミナル上でもAIが利用できるようになりました。
GitHub Copilot Edits 複数フォルダやファイルに同時編集できるようになりました。
GitHub Copilot Agent Mode <<< New!

GitHub Copilot Agent Mode は今まで人間がコードを書き、GitHub CopilotはCopilot(副操縦士)の役割をしていましたが、Agent Modeではメインパイロット(主操縦士)のように操縦をするようになります。
そして人間は指示をする管制官の役割に昇格しました。

しかし、GitHub Copilot Agent Modeは今のところ、評判はあまり芳しくありません。
GitHub Copilot Agent Modeに似たVSCodeの拡張機能である「Cline」が今のところ機能的に先行しています。

# 本題

VSCode のワークスペースを使います。
VSCode のワークスペースは別のドライブのフォルダであっても同一箇所のものとみなしてくれます。

srcフォルダ: アプリをNext.jsやHono、Drizzle、Supabaseを使って開発します。
docフォルダ: ドキュメントをMarkdownで書きます。

doc構成

アプリの構想、概要
要件定義
仕様書
画面設計書、ワイヤーフレーム
画面遷移図
機能設計書
URL設計書
API設計書
データベース設計書
データベーススキーマ
データベース関連図
テスト設計書
非機能要件
等を書きます。

※AIに与える情報は正確に細かく多いほうがよいです。

# GitHub Copilot Agent Mode

GitHub Copilot Agent Mode がVSCode Insiders (VSCodeの先行実験バージョン)で使えるようになりました、
解説によると、Agent Modeは全体を見ると明言されていました。
なのでsrcフォルダとdocフォルダをモノレポのように同じワークスペースにおいて実際に動かしてみようというものです。
srcへの指示はClineなどを始め色々工夫されていますが、ドキュメント自体をそばにおいて開発するというのはまだ見かけてないので(私の観測範囲)自分で試してみます、

方法
アプリは通常通り開発して、そのそばにドキュメントを置きドキュメントはMarkdownで書きます。
(色々見て回るとMarkdownだとAIが理解しやすいとの意見がありました。)

心配
ドキュメントが長い場合、それをすべて読み込んでくれるのか？
ドキュメントをどの程度の細部まで書く必要があるのか？
大きいアプリを小さい機能ごとに分けて開発したい場合に、その指示通りに動いてくれるのか？

# 結果
現在実験中・・・

基本的にAIに設計書もコードも書いてもらう。
アプリの構想や概要は人間が考えるのは当然として、



# 強いAIと弱いAI
現在AIと呼ばれているものは弱いAIと言われているもので、人間が指示しないと動きません、
では強いAIは何かと言われると、自発的に考え実行するAI、つまりSFの世界の自立型AIになります。

















はい、承知いたしました。「強いAIと弱いAI」をテーマに、800文字程度のブログ記事を作成します。

## 強いAIと弱いAI：SFの世界はすぐそこに？

近年、私たちの生活に浸透しつつあるAI（人工知能）。ニュースやCMでAIという言葉を聞かない日はありません。しかし、現在「AI」と呼ばれているもののほとんどは、「弱いAI」に分類されることをご存知でしょうか？

では、「弱いAI」と「強いAI」は何が違うのでしょうか？

### 弱いAI：特化型のエキスパート

現在のAI技術の主流である「弱いAI」は、特定のタスクに特化しています。例えば、画像認識、音声認識、自然言語処理などが挙げられます。これらのAIは、与えられたデータに基づいて学習し、特定のタスクを効率的に実行できます。しかし、自ら考えたり、異なるタスクを組み合わせたりすることはできません。

身近な例としては、スマートフォンの音声アシスタントや、Webサイトのチャットボットなどが挙げられます。これらは、特定の質問に対しては正確に答えることができますが、会話の流れを理解したり、状況に応じて柔軟に対応したりすることは苦手です。

### 強いAI：自律的に考える未来の知性

一方、「強いAI」は、人間のように自律的に考え、行動できるAIを指します。SF映画に登場するような、自我を持ち、感情を理解し、人間と対等にコミュニケーションできるAIが、まさに「強いAI」です。

「強いAI」は、与えられた情報だけでなく、自ら情報を収集し、学習し、問題解決を行うことができます。また、未知の状況にも対応し、創造的なアイデアを生み出すことも可能です。

しかし、「強いAI」はまだ実現していません。人間と同等、あるいはそれ以上の知能を持つAIを開発するためには、人間の脳の仕組みを解明し、それを再現する必要があります。これは、現代の科学技術ではまだ難しい課題です。

### AIの未来：共存と進化

「強いAI」の実現はまだ先のことですが、「弱いAI」はすでに私たちの生活に大きな影響を与えています。今後も、AI技術は進化し続け、私たちの生活や社会を大きく変えていくでしょう。

AIと人間が共存する未来では、AIは人間の能力を補完し、より豊かな社会を実現するためのパートナーとなることが期待されます。そのためには、AI技術の発展だけでなく、倫理的な問題や社会的な課題についても議論し、解決していく必要があります。

AIの進化は、私たちに多くの可能性をもたらすと同時に、新たな課題も突きつけます。AIとのより良い未来を築くために、私たち一人ひとりがAIについて理解を深め、積極的に関わっていくことが大切です。


# ０から調律しよう

まず自分でテンプレートを作ります。

Next.js
Supabase
Drizzle
Hono
TailwindCSS
で基礎的なアプリを作ります。

まず自分で手作りをします。

ここで最低限動くのを作ります。

次に、全く同じものをAIに作ってもらいます。

Next.js
Supabase
Drizzle
Hono
TailwindCSS
を使って基礎的なCRUDアプリを作ります。

これを同じになるまでルールを決めてAIに作ってもらいます。
AIに開発のプロセスや各ステップの説明も行わせます。


最初のルール

```rule.md

Next.js
Supabase
Drizzle
Hono
TailwindCSS

```

TDDは別に独立させます。
どうやらAIは言葉では理解しているようで本質的に
テストコードもアプリの一部でしか無いようです。

TDDは人間用の開発手法でAIとはあいません。

なのでAIにコードを書いてもらってから
別にコードを見てもらってAIでテストを書き、それを人間がチェックをします。
それに加えて、AIが生成したテストについて、どのように改善できるかを人間がフィードバックします。

TDDは
リスト＞テスト＞コード
ですが
AIのTDDは
リスト＞自然言語の指示＞コード＞テスト＞適正コード
の順番になります。

全体を設計した後、AIにコードをすべて書いてもらいその後、小さな機能を書いてくトップダウン型、

全体を設計した後、小さな機能を作った後、全体をまとめていくボトムアップ型
などを調べています。

例えば
設計
Next.js等をインストール
最低限のコード＝テンプレート
v0でコンポーネントを作成、実装
それに合わせてAIに統合してもらう。
テスト
レッド、失敗なら繰り返す
グリーン、成功したら次のステップへ

AIに効果的に指示を出すための言語の設計について検討します。
また、指示の質を向上させる方法や、AIの生成物を適切に評価する基準についても考察する予定です。


AIは設計書通りに作ろうとします。
一部分を作ってテストして
もしくは
テストを付くてからその通りにコードを実装する
というやり方はそぐいません。

AIに設計書通りに全体を作ってもらってから
そこから重要な部分にテストを書いてもらっていくというやり方になっていくのではないでしょうか？

そうすれば、次にAIで改修する時にレグレッションテストを兼ねることが出来ると思います。


TDDはリスト＞テスト＞コードの順番で回転させ開発するが、AIでのTDDは別の名前が必要になるかも。リスト＞AIのコード(一気に作る)＞AIのテスト(重要な部分に当てはめていく) ＞調整＞完成 これでリグレッションに耐えてAIに次のコードを書いて貰えるようになる。


# 一つのルールから

Next.jsアプリを開発する。

Next.jsのインストール後

一つのアプリの設計書を作成
TODOリストを作る

一つのルールを設定。

実行
期待通りに動いたかを検証。

期待通りに動かなかったら
ルールを修正

期待通りに動いたら
２つ目のルールを追加

これを繰り返す。

ただし、新しいツールは追加しない。
Supabase
Drizzle
TailwindCSSなどはまだ追加しない。

Next.jsだけで出来るアプリを開発します。

Next.js用のルールが完成してから
初めて新しいツールを追加します。

gitを設定しておけば、戻すボタンで一発で元に戻ります。
不安ならばdevブランチを切ってそこでAIの指示をします。

AIにどのようなルールを追加すればいいかを相談する

AIの提案と
開発者が期待するコードとの一致を目指します。

Design-Driven Development
DDD

ルール、設計駆動開発

