<!--
title:   Next.js App Dir 認証機能付き (メール GitHub) 開発用テンプレート (Supabase shadcn/ui Storybook )
tags:    GitHub認証,Next.js,Supabase,shadcn,メール認証
id:      12da291e560c4850b511
private: true
-->

# VNS





# 開発中の確認＆ダッシュボード

Next.js

http://localhost:3000

Storybook

http://localhost:6006/

ローカルの Supabase

http://localhost:54323/projects

サーバーの Supabase

https://app.supabase.com/projects

Vercel

https://vercel.com/dashboard

---

# 便利サイト、チートシート

Tailwind CSS Cheat Sheet

https://tailwindcomponents.com/cheatsheet/

---




# 開発時の重要コマンド

よく使うコマンドや便利ツール等

```
Supabase CLI 更新
scoop update supabase

Next.jsローカルサーバーを起動
npm run dev

storybookを起動
npm run storybook

supabase start
supabase stop
supabase db reset
supabase status

Supabase ダッシュボード
http://localhost:54323

ストーリーブック
npm run storybook

インタラクションテスト (storybookを起動させて)
npm run test-storybook

Vercel
npm vercel login
npm vercel link
npm vercel env pull

インストール時から一定期間後に別ブランチを立てて実行
update可能なパッケージ一覧を取得
npm outdated

npm update

インストール
npm install -g npm-check-updates
npm-check-updates

ncu

全て最新バージョンにアップデートしたい場合は
ncu -u



開発ブランチのマージ

git checkout main
git merge -
※ - 記号は直前にチェックアウトしたブランチを指定してマージします。

JSDocを利用した自動生成ドキュメント
npm run doc

eslintでのチェック ルールに従ってないファイルをリスト表示します。
npx eslint src/**/*


```




# 開発のサイクル

開発のサイクルとして、作業ブランチを作り、そこでコードを書いてテストして、その後にコミットしたら main ブランチに移動後マージします。(これを繰り繰り返します。)

作業ブランチの作成
git checkout -b <branch-name>

※作業します。

main ブランチに移動
git checkout main

ブランチのマージ
直前にいたブランチのマージ
git merge -

（不要になった）ブランチの削除
git branch -d <branch-name>

---

# ルール

書いたコードは src フォルダ以下に移動する
src/

共通の style コード
src/styles

ブランチは基本 2 種類
main ブランチ 公開用のコード
必要に応じて開発用のブランチを作成(ここで開発をする)
この２つを軸に開発していく
一区切りついたら開発用のブランチを main にマージしていく



---



### コロケーション

コロケーションとは、
関連するコードを近くに配置することで、
コードの理解性を向上させる設計パターンの一つです。
コロケーションパターンともいいます。

コロケーションパターンを採用することで
リマインド効果がある
半年前の自分は別人理論
コードを読みやすくする

一つのフォルダの中に一つのコンポーネント単位を置く
コンポーネントは複数のコンポーネントで成り立っておい
一つはデータコンポーネント
一つは表示コンポーネント
をつかう
テストファイルと
Story ファイルも一緒に
コンポーネントフォルダの root に置く

コロケーション | makotot.dev ファイルの配置

https://www.makotot.dev/posts/colocation-translation-ja

インタラクションテスト
ストーリーとテストを一元管理できる
ストーリーファイルにテストを記述する事になるため、
ストーリーとテストを一元管理できます。

テストを実行する方法は主に 2 つで、
通常はブラウザ上で Storybook を
表示して実行します。

テストランナーをセットアップすることで、
CLI での実行が可能になります。

# ディレクトリ構成

```tree
src
├── app
│   ├── layout.tsx
│   └── page.tsx
├── components
│   ├── ui
│   │   ├── alert-dialog.tsx
│   │   ├── button.tsx
│   │   ├── dropdown-menu.tsx
│   │   └── ...
│   ├── main-nav.tsx
│   ├── page-header.tsx
│   └── ...
├── lib
│   └── utils.ts
├── styles
│   └── globals.css
├── next.config.js
├── package.json
├── postcss.config.js
├── tailwind.config.js
└── tsconfig.json

```

参考
Next.js - shadcn/ui

https://ui.shadcn.com/docs/installation/next

---





---




# テンプレートで使用するツールの調査

Next.js をインストール

<details><summary>インストールする予定のツール (長い)</summary>

(未)＝未インストール＆インストール候補

※ 重要なのは必要になった時に調べてインストールする。
一気に全部入れても混乱するだけで使いこなせません。

Next.js by Vercel - The React Framework

https://nextjs.org/

TypeScript: JavaScript With Syntax For Types.

https://www.typescriptlang.org/

Tailwind CSS - Rapidly build modern websites without ever leaving your HTML.

https://tailwindcss.com/

Find and fix problems in your JavaScript code - ESLint - Pluggable JavaScript Linter

https://eslint.org/

Prettier · Opinionated Code Formatter

https://prettier.io/

The Open Source Firebase Alternative | Supabase

https://supabase.com/

Storybook: Frontend workshop for UI development

https://storybook.js.org/

GitHub Japan | GitHub

https://github.co.jp/

Vercel

https://vercel.com/

(未) tRPC - Move Fast and Break Nothing. End-to-end typesafe APIs made easy. | tRPC

https://trpc.io/

tRPC は App router 未対応です。

[tRPC App router 対応状況](https://github.com/trpc/trpc/issues/3297)

## テスト関連

(未) Vitest | A blazing fast unit test framework powered by Vite

https://vitest.dev/

サンプル
next.js/examples/with-vitest at canary · vercel/next.js · GitHub

https://github.com/vercel/next.js/tree/canary/examples/with-vitest

(未) Chromatic: Storybook deployment, review, and test

https://www.chromatic.com/

(未) Testing Library | Testing Library

https://testing-library.com/

(未) JavaScript Component Testing and E2E Testing Framework | Cypress

https://www.cypress.io/

(未) Fast and reliable end-to-end testing for modern web apps | Playwright

https://playwright.dev/

(未) Jest · 🃏 Delightful JavaScript Testing

https://jestjs.io/ja/

## i18n 国際化

(未) react-i18next

Introduction - react-i18next documentation

https://react.i18next.com/

サンプル
next.js/examples/app-dir-i18n-routing at canary · vercel/next.js · GitHub

https://github.com/vercel/next.js/tree/canary/examples/app-dir-i18n-routing

# 他のインストール候補

## UI ＆ CSS

### Next.js の app router に対応している UI コンポーネント集

shadcn/ui

https://ui.shadcn.com/

Next.js - shadcn/ui

https://ui.shadcn.com/docs/installation/next

React の UI コンポーネントなら@shadcn/ui がちょうどいい

https://zenn.dev/mottox2/articles/react-shadcn-ui

(未) Kuma UI

https://www.kuma-ui.com/

(未) Mantine next example

https://v7.mantine.dev/

Can I use Mantine with Next.js app dir?
Currently, it is not recommended, we are working on new major version that will resolve all of the current issues related to server side rendering.

> Mantine を Next.js app dir で使用できますか？
> サーバーサイドレンダリングに関する現在の問題をすべて解決する新しいメジャーバージョンを開発中です。

この version7 が開発中です。

### Next.js の app router に対応している CSS

(未) vanilla-extract — Zero-runtime Stylesheets-in-TypeScript.

https://vanilla-extract.style/

CSS・TypeScript の相性が抜群。vanilla-extract が最高の CSS 開発体験をくれた

https://zenn.dev/moneyforward/articles/vanilla-extract

## デザイン

Figma

https://www.figma.com/

## 開発時の利用ツール

### DB関連

#### SQLクライアント

DBeaver Community

https://dbeaver.io/download/

TablePlus | Modern, Native Tool for Database Management

https://tableplus.com/download

A5:SQL Mk-2 - フリーの SQL クライアント/ER 図作成ソフト (松原正和)

https://a5m2.mmatsubara.com/

# その他

(未) Zod | Documentation

https://zod.dev/

(未) Prisma | Next-generation ORM for Node.js & TypeScript

https://www.prisma.io/

</details>


























# テンプレートを使用する方法

このリポジトリ↓がテンプレートとして利用できます。

masakinihirota/vns


https://github.com/masakinihirota/vns
https://github.com/masakinihirota/vns

「Use this template」
緑ボタンを押します。

新しいリポジトリが出来るのでそこから開発を始めます。



# この記事の趣旨

このリポジトリは既存のツールを組み合わせているだけなので何の機能もありません。
だからサンプルやデモではなくテンプレートです。

ただ、現在、複数の機能をまとめるだけでも微妙な設定変更が必要で、それには多くの調査が必要になるためここにテンプレートとして記録に残しておきます。

この記事ではNext.js の↓公式サンプルを利用したテンプレートを作成します。

next.js/examples/with-supabase at canary · vercel/next.js

https://github.com/vercel/next.js/tree/canary/examples/with-supabase



またこのリポジトリは
Supabaseで推奨↓されている方法です。

Supabase Auth with the Next.js App Router | Supabase Docs

https://supabase.com/docs/guides/auth/auth-helpers/nextjs

```
Automatic Configuration (recommended)#

npx create-next-app -e with-supabase

```

と書かれています。




# 前提条件

Supabaseのアカウントは作成して、
プロジェクトを作ってあるものとします。

開発環境や技術選定にあるツールはある程度知っているものとします。



# 開発環境

Windows 10
PowerShell
VSCode with GitHub Copilot chat
Next.js 13 app dir
Supabase
Storybook
shadcn/ui
Vercel
i18n
JSDoc



# 技術選定

Next.js
Supabase
メール認証（cookie）
GitHub認証
shadcn/ui
Storybook
ダークモード
i18n



# 追加予定

GitHub認証
Supabase
shadcn/ui
i18n
JSDoc
Storybook
Vercel



# 土台となるサンプルをインストール

Next.js公式サンプルをインストールします。

npx create-next-app -e with-supabase

npm i eslint eslint-config-next

Vercelにデプロイしてから連携してあるので
.envは不要

## 環境ファイルを作る

※Supabaseでプロジェクトを作成済みで、
プロジェクトの設定情報は知っているものとします。

touch .env.local

```.env.local
NEXT_PUBLIC_SUPABASE_URL=https://zhlmcrnnjbsfhbnctenz.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=ey***********************************74

```

.env.local.example
は削除します。


# srcフォルダの作成 ディレクトリの移動

mkdir src

srcの下にappディレクトリとcomponentsディレクトリを移動します。


tsconfig.jsonファイルを一部変更

```tsconfig.json
    "paths": {
      "@/*": ["./src/*"]
    }

```


tailwind.config.jsファイルを一部変更

```tailwind.config.js
  content: [
    "./src/pages/**/*.{js,ts,jsx,tsx,mdx}",
    "./src/components/**/*.{js,ts,jsx,tsx,mdx}",
    "./src/app/**/*.{js,ts,jsx,tsx,mdx}",
  ],

```

※src/pages はNext.jsのpages dirを使っていたときの名残です。
Next.js 13 は pages dir と app dir の両方を同時に使えるので残しておきます。




# 動作確認

npm run dev

を実行すると起動確認が出来るはずです。

これでサンプルのインストールまでは完了です。


# 微調整

mkdir src/styles


```src\styles\globals.css
@tailwind base;
@tailwind components;
@tailwind utilities;


```



package.jsonファイルを一部変更

```package.json
  "name": "vns.blue",
  "version": "0.1.0",

```

※名前は自由につけてください。





# 動作確認

npm run dev

ログインできるようになっていると思います。



●●●●●●●●●●●●●●●●●●●●●●●
●●●●●●●●●●●●●●●●●●●●●●●

eslint

with-supabaseにはeslintが無いのでインストールをする。

npx create-next-app -e with-supabase


.eslintrc.json(初期)

touch .eslintrc.json


```.eslintrc.json
{
  "extends": "next/core-web-vitals"
}

```



## tsconfig.json

TypeScriptを開発しやすくする

```tsconfig.json (変更箇所)
    "strict": false,
    "strictNullChecks": true,

```

"strict": false は、以下の設定を無効にします。

"noImplicitAny": true：暗黙的にany型として解釈される式を許可しません。
"strictNullChecks": true：nullとundefinedの扱いに関する厳密な型チェックを有効にします。
"strictFunctionTypes": true：関数の型チェックを厳密に行います。
"strictPropertyInitialization": true：クラスのプロパティの初期化を厳密に行います。
"noImplicitThis": true：thisの型チェックを厳密に行います。

↑この５つのうち

"strictNullChecks"だけ有効にします。



## VSCode の設定

VSCode の拡張機能を入れます。

ESLint - Visual Studio Marketplace

https://marketplace.visualstudio.com/items?itemName=dbaeumer.vscode-eslint

Prettier - Code formatter - Visual Studio Marketplace

https://marketplace.visualstudio.com/items?itemName=esbenp.prettier-vscode

Headwind - Visual Studio Marketplace

https://marketplace.visualstudio.com/items?itemName=heybourn.headwind

※拡張機能 Headwind はTailwindCSSの className を全て同じように並べ替えます。

【自動整形】VSCode で Prettier を使う方法【設定必要です】 | RalaCode

https://ralacode.com/blog/post/vscode-prettier/

```setting.json (追記)
  // フォーマットをprettierで実行
  "editor.defaultFormatter": "esbenp.prettier-vscode",
  // 貼り付け時にフォーマット
  "editor.formatOnPaste": false,
  // 入力直後にフォーマット
  "editor.formatOnType": false,
  // 保存直後にフォーマット
  "editor.formatOnSave": true,

  "editor.codeActionsOnSave": {
    // import文を自動で探して挿入する。
    "source.addMissingImports": true,
    // 保存時にeslintを実行
    "source.fixAll.eslint": true
  },

```

※設定をする事で言語別に(TypeScript, markdown, html等)フォーマットの設定ができます。

VSCodeのフォーマット

Default FormatterをPrettierにする設定。

```setting.json
"editor.defaultFormatter": "esbenp.prettier-vscode"

```

プラグインがの効果をみるために src\app\page.tsx を全体的に書き換えます。


```src\app\page.tsx
import { createServerComponentClient } from "@supabase/auth-helpers-nextjs"
import { cookies } from "next/headers"
import Link from "next/link"
import LogoutButton from "../components/LogoutButton"
import SupabaseLogo from "../components/SupabaseLogo"
import NextJsLogo from "../components/NextJsLogo"

export const dynamic = "force-dynamic"

const resources = [
  {
    title: "Cookie-based Auth and the Next.js App Router",
    subtitle:
      "This free course by Jon Meyers, shows you how to configure Supabase Auth to use cookies, and steps through some common patterns.",
    url: "https://youtube.com/playlist?list=PL5S4mPUpp4OtMhpnp93EFSo42iQ40XjbF",
    icon: "M7 4V20M17 4V20M3 8H7M17 8H21M3 12H21M3 16H7M17 16H21M4 20H20C20.5523 20 21 19.5523 21 19V5C21 4.44772 20.5523 4 20 4H4C3.44772 4 3 4.44772 3 5V19C3 19.5523 3.44772 20 4 20Z",
  },
  {
    title: "Supabase Next.js App Router Example",
    subtitle:
      "Want to see a code example containing some common patterns with Next.js and Supabase? Check out this repo!",
    url: "https://github.com/supabase/supabase/tree/master/examples/auth/nextjs",
    icon: "M10 20L14 4M18 8L22 12L18 16M6 16L2 12L6 8",
  },
  {
    title: "Supabase Auth Helpers Docs",
    subtitle:
      "This template has configured Supabase Auth to use cookies for you, but the docs are a great place to learn more.",
    url: "https://supabase.com/docs/guides/auth/auth-helpers/nextjs",
    icon: "M12 6.25278V19.2528M12 6.25278C10.8321 5.47686 9.24649 5 7.5 5C5.75351 5 4.16789 5.47686 3 6.25278V19.2528C4.16789 18.4769 5.75351 18 7.5 18C9.24649 18 10.8321 18.4769 12 19.2528M12 6.25278C13.1679 5.47686 14.7535 5 16.5 5C18.2465 5 19.8321 5.47686 21 6.25278V19.2528C19.8321 18.4769 18.2465 18 16.5 18C14.7535 18 13.1679 18.4769 12 19.2528",
  },
]

const examples = [
  { type: "Client Components", src: "app/_examples/client-component/page.tsx" },
  { type: "Server Components", src: "app/_examples/server-component/page.tsx" },
  { type: "Server Actions", src: "app/_examples/server-action/page.tsx" },
  { type: "Route Handlers", src: "app/_examples/route-handler.ts" },
]

export default async function Index() {
  const supabase = createServerComponentClient({ cookies })

  const {
    data: { user },
  } = await supabase.auth.getUser()

  return (
    <div className="flex flex-col items-center w-full">
      <nav className="flex justify-center w-full h-16 border-b border-b-foreground/10">
        <div className="flex items-center justify-between w-full max-w-4xl p-3 text-sm text-foreground">
          <div />
          <div>
            {user ? (
              <div className="flex items-center gap-4">
                Hey, {user.email}!
                <LogoutButton />
              </div>
            ) : (
              <Link
                href="/login"
                className="px-4 py-2 no-underline rounded-md bg-btn-background hover:bg-btn-background-hover"
              >
                Login
              </Link>
            )}
          </div>
        </div>
      </nav>
      <div className="text-green-400">borderの下の部分</div>
      <h1 className="pt-2 p-4">VNS.BLUE</h1>
      Next.js app router 開発用テンプレート (Storybook Supabase shadcn/ui)
    </div>
  )
}

```





↑ このコードを保存すると、その瞬間に自動でフォーマット↓が実行されます。

<h1 className="pt-2 p-4">VNS.BLUE</h1>

↑ この部分が自動で並べ替えが行われます。↓

<h1 className="p-4 pt-2">VNS.BLUE</h1>

動作確認
npm run dev








### .eslintignore ファイルの作成

.eslintignore を作成します。

touch .eslintignore

↓lint 対象から外したいファイルを設定します。

```.eslintignore
# config
.eslintrc.json
.prettierrc
next.config.js
tailwind.config.js
tsconfig.json
postcss.config.js

# build dir
build/
bin/
obj/
out/
.next/

# 自動生成されたファイル
package-lock.json

# Storybook
*.stories.ts
*.stories.tsx

# CSSファイル
*.css

# mdxファイル
*.mdx

# すべての画像ファイルを除外する
**/*.png
**/*.jpg
**/*.jpeg
**/*.gif
**/*.ico

```








# prettier

公式サイト Install Prettier

https://prettier.io/docs/en/install.html

prettier のインストール

npm install -D prettier

eslint と設定が衝突するのを避けるための設定

npm install -D eslint-config-prettier

空の.prettierrc を作成して、Prettier を使用していることをエディターやその他のツールに知らせます。

touch .prettierrc

```.prettierrc

```

Prettier を VSCode で使うにはデフォルトのフォーマッターを Prettier に設定する必要があります。

.eslintrc.json に prettier 設定の追加をします。

```.eslintrc.json
{
  "extends": [
    "next/core-web-vitals",
    "prettier"
  ]
}

```

package.json に format コマンドを追加します。

```package.json (追記)
"scripts": {
  "format": "prettier --write ."
  ...

```

## .prettierrc 設定ファイルの追加

.prettierrc ファイルを設定します。

```.prettierrc
{
  "tabWidth": 2,
  "useTabs": false
}

```

※ルールは各自で好きなように設定してください。

↓ このプラグインは推奨されなくなりました。
eslint-plugin-prettier

次に、.prettierignore ファイルを作成して、
どのファイルをフォーマットしないかを Prettier CLI とエディターに知らせます。

touch .prettierignore

```.prettierignore
# Ignore artifacts:
build
coverage

# dotfile
.env*

# markdown
*.md

# next.js
/.next/
/out/

# production
/build

package-lock.json

*.stories.ts
*.stories.tsx

```



## Prettier コマンド一覧

※通常は VSCode 側を設定すれば、保存時に自動で実行されるので、コマンドを打つことはほとんどありません。

動作確認のため prettier を実行します。

全体をフォーマットします。
npx prettier . --write

src ディレクトリ以下をフォーマットします。
npx prettier src/ --write

巨大プロジェクトの場合に時間短縮のためフォルダを指定したい場合
npx prettier [フォルダ名] --write

直接ファイルを指定する場合
npx prettier src\app\page.tsx --write

prettier が実行済みかの確認（上書きはしない）
npx prettier . --check



# eslint-plugin-import

Next.js 開発 ESLint で import 文の自動挿入、自動削除、自動ソート - Qiita

https://qiita.com/masakinihirota/items/fae505a58892b00550a7

npm install -D eslint-plugin-unused-imports --legacy-peer-deps


```.eslintrc.json
{
  "extends": ["next/core-web-vitals", "prettier"],
  "plugins": ["unused-imports"],
  "rules": {
    "unused-imports/no-unused-imports": "error"
  }
}

```

※ ↑この設定は必要な最小限の設定にしてあるので、自動挿入、自動削除の確認用として有効です。





さらに、並べ替えのルールを追加します。

```.eslintrc.json
{
  "extends": ["next/core-web-vitals", "prettier"],
  "plugins": ["unused-imports"],
  "rules": {
    // TypeScriptで未使用の変数を許可するかどうかを指定します。この例では、offに設定されているため、未使用の変数を許可します。
    "@typescript-eslint/no-unused-vars": "off",
    // 未使用のインポートに関するルールを指定します。この例では、warnに設定されているため、未使用のインポートがある場合に警告を出します。
    "unused-imports/no-unused-imports": "warn",
    // モジュールのインポート順序に関するルールを指定します。この例では、配列の中に複数のグループが定義されています。各グループは、groupsプロパティで定義されています。
    "import/order": [
      "warn",
      {
        "groups": [
          // builtin: Node.js に組み込まれているモジュール
          // external: npm install 等 プロジェクト外部からインストールされたモジュール
          // internal: プロジェクト内のモジュールで、パスを指定してインポートされたもの
          // parent: 親モジュール 相対パスを使用してインポートされたもの
          // sibling: 兄弟モジュール 相対パスを使用してインポートされたもの
          // index: インデックスファイルで、相対パスを使用してインポートされたもの
          // object: オブジェクトファイルで、相対パスを使用してインポートされたもの
          // type: 型ファイルで、相対パスを使用してインポートされたもの
          "builtin",
          "external",
          "internal",
          ["parent", "sibling"],
          "index",
          "object",
          "type"
        ],
        // それぞれのgroupsとの間は1行分空けます。
        "newlines-between": "always",
        // 特定のグループの import 文を除外するかどうかを指定します。
        "pathGroupsExcludedImportTypes": ["builtin", "external"],
        // order オプションは、アルファベット順にします。
        // caseInsensitive オプションは、大文字小文字を無視してアルファベット順に並べるかどうかを指定します。
        "alphabetize": { "order": "asc", "caseInsensitive": true },
        "pathGroups": [
          // pattern: インポートパスのパターンを指定します。この例では、src/ディレクトリ以下のすべてのファイルを指定しています。
          // group: インポートパスが一致した場合に、どのグループに属するかを指定します。この例では、internalグループに属するように指定しています。
          // position: インポートパスが一致した場合に、どの位置に挿入するかを指定します。この例では、beforeに指定しているため、他のグループよりも前に挿入されます。
          {
            "pattern": "src/**",
            "group": "internal",
            "position": "before"
          }
        ]
      }
    ]
  }
}

```




















## ESlintにTypeScriptのルールを追加

typescript-eslint

https://typescript-eslint.io/


npm install --save-dev @typescript-eslint/parser

※↑上記サイトの他のプラグインを使用すると、ESLintの他の機能が正常に動作しなくなるため、そのプラグインは外しました。

```.eslintrc.json
{
  "extends": ["eslint:recommended", "next/core-web-vitals", "prettier"],
  "parser": "@typescript-eslint/parser",
  "parserOptions": {
    // tsx ファイル内のJSX構文を正しく解析できるようになります。
    "ecmaFeatures": {
      "jsx": true
    },
    "ecmaVersion": 2020,
    "sourceType": "module",
    "jsx": "react"
  },
  // react: Reactの構文を解析するためのルールを提供します。
  // import: import文の構文を解析するためのルールを提供します。
  // unused-imports: 未使用のimport文を検出するためのルールを提供します。
  "plugins": ["react", "import", "unused-imports"],
  "root": true,
  "rules": {
    // TypeScriptで未使用の変数を許可するかどうかを指定します。この例では、offに設定されているため、未使用の変数を許可します。
    "@typescript-eslint/no-unused-vars": "off",
    // 未使用のインポートに関するルールを指定します。この例では、warnに設定されているため、未使用のインポートがある場合に警告を出します。
    "unused-imports/no-unused-imports": "warn",
    // モジュールのインポート順序に関するルールを指定します。この例では、配列の中に複数のグループが定義されています。各グループは、groupsプロパティで定義されています。
    "import/order": [
      // エラーだと動作が止まります。
      // 警告だと警告表示はされますが動作は止まりません。
      "warn",
      {
        "groups": [
          // builtin: Node.js に組み込まれているモジュール
          // external: npm install 等 プロジェクト外部からインストールされたモジュール
          // internal: プロジェクト内のモジュールで、パスを指定してインポートされたもの
          // parent: 親モジュール 相対パスを使用してインポートされたもの
          // sibling: 兄弟モジュール 相対パスを使用してインポートされたもの
          // index: インデックスファイルで、相対パスを使用してインポートされたもの
          // object: オブジェクトファイルで、相対パスを使用してインポートされたもの
          // type: 型ファイルで、相対パスを使用してインポートされたもの
          "builtin",
          "external",
          "internal",
          ["parent", "sibling"],
          "index",
          "object",
          "type"
        ],
        // それぞれのgroupsとの間は1行分空けます。
        "newlines-between": "always",
        // 特定のグループの import 文を除外するかどうかを指定します。
        "pathGroupsExcludedImportTypes": ["builtin", "external"],
        // order オプションは、アルファベット順にします。
        // caseInsensitive オプションは、大文字小文字を無視してアルファベット順に並べるかどうかを指定します。
        "alphabetize": { "order": "asc", "caseInsensitive": true },
        "pathGroups": [
          // pattern: インポートパスのパターンを指定します。この例では、src/ディレクトリ以下のすべてのファイルを指定しています。
          // group: インポートパスが一致した場合に、どのグループに属するかを指定します。この例では、internalグループに属するように指定しています。
          // position: インポートパスが一致した場合に、どの位置に挿入するかを指定します。この例では、beforeに指定しているため、他のグループよりも前に挿入されます。
          {
            "pattern": "src/**",
            "group": "internal",
            "position": "before"
          }
        ]
      }
    ]
  }
}

```

import文の自動削除や自動挿入は保存ボタンを押すと実行されます。（VSCode 側で Prettier が自動実行の設定がされている場合）

(1度で動かない時は 保存ボタンを2,3回押してみてください。)

JavaScript と TypeScript のそれぞれの lint 設定

各個人それぞれが必要になったらインストールしてください。

Getting Started | typescript-eslint

https://typescript-eslint.io/getting-started/

Linting with Type Information | typescript-eslint

https://typescript-eslint.io/linting/typed-linting/

Configurations | typescript-eslint

https://typescript-eslint.io/linting/configs/












## ESlintでのチェックを実行する

### *.tsxファイルのみをチェックする場合

npx eslint src/**/*.tsx

### 全ファイルをチェックする場合

npx eslint src/**/*

※チェックをしないファイルタイプは .eslintignore に登録します。


↑上記コマンドを実行してエラーや警告を消します。














































# JSDoc

AI (GitHub Copilot chat) を利用して開発する場合には、JSDocを書くことが必須になると思っているので導入します。
JSDoc を書くのはAI(GitHub Copilot chat等)に任せます。

ESLint を使って JSDoc / TSDoc の記述を必須化すします。

https://zenn.dev/wakamsha/articles/setup-eslint-plugin-jsdoc



## JSDocのインストール

今回はグローバルインストールします。
npm install -g jsdoc

※各自の環境に合わせて好きな方法でインストールしてください。

npm install --save-dev eslint-config-google



## ESLintにJSDocを強制する場合の設定

.eslintrc.jsonに追記します。

"google"
↑このルールはJSDocを強制的に使用するように促します。

※JSDocが書いてないとエラーが出ます。

```.eslintrc.json

  "env": {
    "es6": true
  },
  "extends": [
    "eslint:recommended",
    "next/core-web-vitals",
    "google",
    "prettier"
  ],
  "parser

```

eslint-config-google - npm

https://www.npmjs.com/package/eslint-config-google

※Google スタイルを ESLint の推奨ルール セットと組み合わせて使用​​するには、両方を拡張し、必ずgoogle最後にリストします。

eslint-config-* の比較表

https://zenn.dev/tapioca/articles/5685d794f6452b

Rules Reference - ESLint - Pluggable JavaScript Linter

https://eslint.org/docs/latest/rules/





コードのチェック
npx eslint src/**/*

今回、ESLintのgoogle規則を追加したのでJSDocが書かれてない関数が表示されるはずです。


それぞれ各関数に↓下を参照してJSDocを書いてください





## VSCodeでJSDocを書く方法

関数がある上の行にカーソルを持ってきて


### 自分で直接書く方法

/** ＋エンターキー
でJSDocの↓テンプレートが自動挿入されます。

```
/**
 *
 * @param inputs
 * @returns
 */
 export default function

```



### 提案して貰う方法

関数のすぐ上の部分にカーソルを持ってきて、
AI (GitHub Copilot chat)のトリガーキーを押すと、
提案が表示されます。

提案が表示されない場合は、↓直接 AI(GitHub Copilot chat)に聞きます。



### AI(GitHub Copilot chat)に直接聞く方法

関数を指定して（関数部分を選択したり、マウスカーソルをその上においたりします）
「JSDocを書いてください」
とお願いする方法。



コンポーネントの場合は@moduleをつけます。

例 JSDocのコメント

```src\app\ModeTogglePage\page.tsx
/**
 * テーマを切り替えるためのドロップダウンメニューを表示するコンポーネント。
 * @module ModeToggle
 * @return {JSX.Element} テーマを切り替えるためのドロップダウンメニューを含む React 要素。
 */
export default function ModeToggle() {
  const { setTheme } = useTheme();


```

※リファクタリングした後でも、AIに修正を依頼すると更新されたJSDocを提案してくれます。




### JSDocの使用例

↓なにか関数を作ります。

```
function increment(num: number): number {
  return num + 1;
}
```

↓関数の上の行にカーソルを持ってきて
`/** ＋エンターキー`
で JSDoc の↓テンプレートが自動挿入されます。

```
/**
 *
 * @param num
 * @returns
 */
function increment(num: number): number {
  return num + 1;
}

```

このままではエラーが出るので GitHub Copilot chat に↓修正をしてもらいます。

```
/**
 *
 * @param {number} num - 数値。
 * @return {number} 引数に1を加えた数値。
 */
function increment(num: number): number {
  return num + 1;
}
```

↓ 説明を追加します。
説明も GitHub Copilot chat で提案してもらいます。

```
/**
 * 引数に1を加えた数値を返す関数。
 * @param {number} num - 数値。
 * @return {number} 引数に1を加えた数値。
 */
function increment(num: number): number {
  return num + 1;
}

```

完成です。



## JSDocからドキュメントを作成する。

typedoc
TypeScript用 JSDocドキュメント生成ツール

typedoc - npm

https://www.npmjs.com/package/typedoc



### インストール

npm -D install typedoc

↓scriptsを追加します。

```package.json
  "scripts": {
    "doc": "typedoc --entryPointStrategy expand ./src"

```



### 実行

npm run doc

↑実行するとdocsフォルダが作成されます。

ブラウザで
`docs\index.html`
を開くとドキュメントが表示されます。



# JSDocのリファレンス

TypeScript: Documentation - JSDocリファレンス

https://www.typescriptlang.org/ja/docs/handbook/jsdoc-supported-types.html

@type
@param (or @arg or @argument)
@return
@typedef
@callback
@template
@class (or @constructor)
@this
@extends (or @augments)
@enum

Use JSDoc: Index

https://jsdoc.app/












## Storybook のインストール

npx storybook@latest init

インストールが完了すると 自動で Storybook のチュートリアルが始まるので体験してみてください。英語ですが始めてStorybookを触る人にとって最初に知っておくべき重要なことが約3分で知ることができます。

TailwindCSS を Storybook でも適用されるように設定します。

```.storybook/preview.ts (追記)
import "../src/styles/globals.css"

```


# Storybook のインストール直後

'aria-query' の型定義ファイルが見つかりません。
というエラーが出たので対処します。

npm install aria-query

tsconfig.jsonファイルに、
"types": ["aria-query"] を追記します。

```tsconfig.json
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./src/*"]
    },
    "types": ["aria-query"]
  },

```


































# shadcn/ui

Next.js - shadcn/ui

https://ui.shadcn.com/docs/installation/next

React の UI コンポーネントなら@shadcn/ui がちょうどいい

https://zenn.dev/mottox2/articles/react-shadcn-ui

コンポーネントは CLI からインストールする方法と
サイトからコードをコピーするやり方があります。

shadcn/ui 公式の推奨 Next.js アプリの構成

```tree
src
├── app
│   ├── layout.tsx
│   └── page.tsx
├── components
│   ├── ui
│   │   ├── alert-dialog.tsx
│   │   ├── button.tsx
│   │   ├── dropdown-menu.tsx
│   │   └── ...
│   ├── main-nav.tsx
│   ├── page-header.tsx
│   └── ...
├── lib
│   └── utils.ts
├── styles
│   └── globals.css
├── next.config.js
├── package.json
├── postcss.config.js
├── tailwind.config.js
└── tsconfig.json

```








セットアップ 初期化

ui や utils のコンポーネント保存フォルダを作っておきます。

mkdir src\components\ui

mkdir src\lib

npx shadcn-ui@latest init

globals.cssのインストール場所は指定します。

src/styles/globals.css

その他は全てデフォルト値を選択します。

```
npx shadcn-ui@latest init
√ Would you like to use TypeScript (recommended)? ... no / yes
√ Which style would you like to use? » Default
√ Which color would you like to use as base color? » Slate
√ Where is your global CSS file? ... src/styles/globals.css
√ Would you like to use CSS variables
for colors? ... no / yes
√ Where is your tailwind.config.js located? ... tailwind.config.js
√ Configure the import alias for components: ... @/components
√ Configure the import alias for utils: ... @/lib/utils
√ Are you using React Server Components? ... no / yes
√ Write configuration to components.json. Proceed? ... yes

✔ Writing components.json...
✔ Initializing project...
✔ Installing dependencies...

Success! Project initialization completed.

```

※VSCodeを再起動します。




```shadcn-u インストールのまとめ
初期化
npx shadcn-ui@latest init

※初期化コマンドは既存設定ファイルがある場合上書きされます。
※インストールコマンドと一緒です。

CLI からのコンポーネントインストール方法
npx @shadcn/ui add

npx @shadcn-ui add [options] [components...]

※addコマンドは既存コンポーネントファイルがあっても上書きされます。(確認)


options:
  -y, --yes          skip confirmation prompt. (default: false)
  -o, --overwrite    overwrite existing files. (default: false)
  -c, --cwd <cwd>    the working directory. defaults to the current directory.
  -p, --path <path>  the path to add the component to.
  -h, --help         display help for command

```



上下キーでカーソルが上下します。
スペースで選択します。
リターンキーで決定します。

```shadcn/uiコンポーネントリスト
components:
( )   accordion
( )   alert
( )   alert-dialog
( )   aspect-ratio
( )   avatar
( )   badge
( )   button
( )   calendar
( )   card
( )   checkbox
( )   collapsible
( )   command
( )   context-menu
( )   dialog
( )   dropdown-menu
( )   hover-card
( )   input
( )   label
( )   menubar
( )   navigation-menu
( )   popover
( )   progress
( )   radio-group
( )   scroll-area
( )   select
( )   separator
( )   sheet
( )   skeleton
( )   slider
( )   switch
( )   table
( )   tabs
( )   textarea
( )   toast
( )   toggle
( )   tooltip

インストールするコンポーネントを選択します。
A ですべてを選択します。

※しかし、すべて選択してインストールするとエラーになりました。

```

このコマンドを実行すると、インストールするコンポーネントを選択できるようになります。

2023年7月26日現在 選択できるコンポーネント
※開発が活発なのでこのリスト以外にも増えている可能性があります。


インストール先を指定します。
src/components/ui
src/components/ui
src/components/ui



※デフォルトでは すでにファイルがあると上書きされません。
上書きしたい場合は -o オプションをつけます。





## お試し

button コンポーネントをインストールしてみます。

npx shadcn-ui@latest add button

or

npx shadcn-ui@latest add
button を選択します。

インストール先を指定します。
src/components/ui
src/components/ui
src/components/ui



動作確認用

なにか適当なページを作成します。

mkdir src\app\about

touch src\app\about\page.tsx

```src\app\about\page.tsx
"use client";

// import文の順番も自動整形されます。
import { type NextPage } from "next";
import Link from "next/link";

import { Button } from "@/components/ui/button";

const Home: NextPage = () => {
  return (
    <main>
      {/* TailwindCSSのプロパティ値も自動整列されます。 */}
      <h1 className="p-4 pt-2">VNS.BLUE</h1>
      Next.js app router 開発用テンプレート (Storybook Supabase shadcn/ui)
      <br />
      {/* ↓この行を消すとimport文が自動削除されます。 */}
      <Link href="/">Home</Link>
      <div>
        <Button>shadcn/ui の Button</Button>
      </div>
    </main>
  );
};

export default Home;

```

ボタンは RSCでは クライアントコンポーネントにする必要があるので
ディレクティブ
"use client"
を先頭行につけます。

そして
npm run dev
を実行して

http://localhost:3000/about
にアクセスするとボタンが表示されます。





# ダークモード

shadcn/ui 公式ドキュメント

Dark Mode - shadcn/ui

https://ui.shadcn.com/docs/dark-mode



# 第１部 Next.js ＋ shadcn/ui ダークモード

## はじめに - shadcn/ui

https://ui.shadcn.com/docs

shadcn/ui はコンポーネントライブラリではありません、
コンポーネントのコレクションです。

必要なコンポーネントを選択します。
コードをコピーしてプロジェクトに貼り付け、
ニーズに合わせてカスタマイズします。

CLI からでもインストールできます。

## インストール - shadcn/ui

https://ui.shadcn.com/docs/installation

Next.js を選択

Next.js - shadcn/ui

https://ui.shadcn.com/docs/installation/next

Next.js のインストール

npx create-next-app@latest shadcn_darkmode --typescript --tailwind --eslint

### TailwindCSS

src\app\globals.css
このファイルの配置を
src\styles\globals.css
へ移動します。

コマンド

New-Item -ItemType Directory -Path "src\styles"

Move-Item -Path "src\app\globals.css" -Destination "src\styles\globals.css"

globals.css ファイルから、デフォルトのインストール画面で必要だった CSS 部分を削除し、TailwindCSS で必要な部分だけを残します。

```src\styles\globals.css
@tailwind base;
@tailwind components;
@tailwind utilities;

```

globals.css ファイルを読み込んでいるファイルの path を修正します。

```src\app\layout.tsx
import '@/styles/globals.css'

...

<html lang='ja'>

```

ja と日本語にも設定しておきます。

## shadcn の初期化

npx shadcn-ui@latest init

global CSS のファイルの場所を指定します。

src/styles/globals.css

初期化が終了すると、components.json というファイルが作成されます。

```components.json
{
  "$schema": "https://ui.shadcn.com/schema.json",
  "style": "default",
  "rsc": true,
  "tsx": true,
  "tailwind": {
    "config": "tailwind.config.js",
    "css": "src/styles/globals.css",
    "baseColor": "slate",
    "cssVariables": true
  },
  "aliases": {
    "components": "@/components",
    "utils": "@/lib/utils"
  }
}

```

## ソース構造（参考）

```tree
src
├── app
│   ├── layout.tsx
│   └── page.tsx
├── components
│   ├── ui
│   │   ├── alert-dialog.tsx
│   │   ├── button.tsx
│   │   ├── dropdown-menu.tsx
│   │   └── ...
│   ├── main-nav.tsx
│   ├── page-header.tsx
│   └── ...
├── lib
│   └── utils.ts
├── styles
│   └── globals.css
├── next.config.js
├── package.json
├── postcss.config.js
├── tailwind.config.js
└── tsconfig.json

```

- UI コンポーネントは components/ui フォルダに配置しています。

- <PageHeader />や<MainNav />などの残りのコンポーネントは、components フォルダに配置します。

- lib フォルダにはすべてのユーティリティ関数が入っています。utils.ts には cn ヘルパーを定義しています。

- styles フォルダにはグローバル CSS が入っています。

## ボタンを追加してみる

コンポーネントのインストール

npx shadcn-ui@latest add

button コンポーネントを選択します。

インストール場所

src\components\ui

インストールされたファイル

src\components\ui\button.tsx

ボタンを表示するコンポーネントを作成します。

```src\app\page.tsx
// import文の順番も自動整形されます。
import { type NextPage } from "next";
import Link from "next/link";

import { Button } from "@/components/ui/button";

const Home: NextPage = () => {
  return (
    <main>
      {/* TailwindCSSのプロパティ値も自動整列されます。 */}
      <h1 className="p-4 pt-2">VNS.BLUE</h1>
      Next.js app router 開発用テンプレート (Storybook Supabase shadcn/ui)
      <br />
      {/* ↓この行を消すとimport文が自動削除されます。 */}
      <Link href="/">Home</Link>
      <div>
        <Button>shadcn/ui の Button</Button>
      </div>
      <br />
      <Link href="./ModeTogglePage">ModeTogglePage</Link>
    </main>
  );
};

export default Home;

```

ボタンコンポーネントテストページ

```src\app\ButtonTestPage\page.tsx
import { Button } from "@/components/ui/button"

export default function Home() {
  return (
    <div>
      <Button>Click me</Button>
    </div>
  )
}

```

```components.json
{
  "$schema": "https://ui.shadcn.com/schema.json",
  "style": "default",
  "rsc": true,
  "tsx": true,          ＜＜＜ TypeScriptを使う場合はtrue
  "tailwind": {
    "config": "tailwind.config.js",
    "css": "src/styles/globals.css",
    "baseColor": "slate",
    "cssVariables": true
  },
  "aliases": {
    "components": "@/components",
    "utils": "@/lib/utils"
  }
}

```

## Theming テーマ設定

Theming - shadcn/ui

https://ui.shadcn.com/docs/theming

テーマ設定に CSS 変数 または TailwindCSS を使用します。

CSS 変数を使用する、
もしくは
Tailwind CSS の ユーティリティクラス を使用するかを選択できます。

↓ ユーティリティクラス の例

<div className="bg-zinc-950 dark:bg-white" />

ユーティリティクラス を使用する場合の設定

```components.json
{
  "style": "default",
  "rsc": true,
  "tailwind": {
    "config": "tailwind.config.js",
    "css": "app/globals.css",
    "baseColor": "slate",
    "cssVariables": false    ＜＜＜ false に設定します。
  },
  "aliases": {
    "components": "@/components",
    "utils": "@/lib/utils"
  }
}

```

CSS 変数 の例

<div className="bg-background text-foreground" />

CSS 変数 を使用する場合の設定

```components.json
{
  "style": "default",
  "rsc": true,
  "tailwind": {
    "config": "tailwind.config.js",
    "css": "app/globals.css",
    "baseColor": "slate",
    "cssVariables": true    ＜＜＜ true に設定します。
  },
  "aliases": {
    "components": "@/components",
    "utils": "@/lib/utils"
  }
}

```

### Convention 規約

色に関しては、シンプルな背景と前景のコンベンションを使用しています。
前景変数はテキスト色に使用されます。
背景変数はコンポーネントの背景色に使用されます。

変数がコンポーネントの背景色に使用される場合、背景接尾辞は省略されます。

例えば、--primary-background という変数は、コンポーネントの背景色に使用する場合は、--primary として省略して使用することができます。

例えば、次のような CSS 変数が与えられます。

--primary: 222.2 47.4% 11.2%;
--primary-foreground: 210 40% 98%;

※ --primary-background は省略され--primary になっています。

--primary とは？
「--primary」は、カスタマイズ可能な CSS 変数の一つで、プロジェクトで使用される主要な色を表します。
この変数は、コンポーネントの背景色やテキスト色など、プロジェクト内の様々な要素の色に使用されます。
例えば、以下のようにして「--primary」変数を使用して、背景色が変更された div 要素を作成することができます。

```
div {
  background-color: var(--primary);
}
```

「The background suffix」とは、前述の通り、背景色に使用される CSS 変数名において、接尾辞として使用される文字列のことを指します。例えば、変数名が「--primary」である場合、背景色に使用する場合は「--primary」とだけ指定し、接尾辞は省略されます。一方、テキスト色に使用する場合は、変数名に「-foreground」などの接尾辞を付けることが一般的です。このように、接尾辞を使用することで、変数名からどのような色が使用されるかを容易に理解することができます。

↑↑ 先程の ↓ この数値は

--primary: 222.2 47.4% 11.2%;
--primary-foreground: 210 40% 98%;

このように使われます。

<div className="bg-primary text-primary-foreground">Hello</div>

このコンポーネントの背景色は hsl(var(--primary))、前景色は hsl(var(--primary-foreground))となります。

CSS 変数の値は、HSL 色空間で定義されています。HSL 色空間は、色相（Hue）、彩度（Saturation）、明度（Lightness）の 3 つの値を使用して色を表現します。HSL 色空間は、RGB 色空間よりも直感的に理解しやすいため、CSS 変数の値を HSL 色空間で定義しています。

HSL とは
HSL は、色相（Hue）、彩度（Saturation）、明度（Lightness）の 3 つの値を使用して色を表現する色空間の一つです。

色相は、色の種類を表し、0 度から 360 度までの値で表されます。
彩度は、色の鮮やかさを表し、0%から 100%までの値で表されます。
明度は、色の明るさを表し、0%から 100%までの値で表されます。

例えば、赤色は色相が 0 度、彩度が 100%、明度が 50%となります。

CSS 変数の値を HSL 色空間で定義することで、色相、彩度、明度の値を直接指定することができます。

### List of variables

カスタマイズ可能な CSS 変数の一覧

```
背景色
Default background color of <body />...その他
--background: 0 0% 100%;
--foreground: 222.2 47.4% 11.2%;

薄い色調の背景色
Muted backgrounds such as <TabsList />, <Skeleton /> and <Switch />
--muted: 210 40% 96.1%;
--muted-foreground: 215.4 16.3% 46.9%;

カードの背景色
Background color for <Card />
--card: 0 0% 100%;
--card-foreground: 222.2 47.4% 11.2%;

ユーザーがマウスオーバーしたときに表示される背景色
Background color for popovers such as <DropdownMenu />, <HoverCard />, <Popover />
--popover: 0 0% 100%;
--popover-foreground: 222.2 47.4% 11.2%;

デフォルトのボーダー色
Default border color
--border: 214.3 31.8% 91.4%;

入力フィールドに使用されるボーダー色
Border color for inputs such as <Input />, <Select />, <Textarea />
--input: 214.3 31.8% 91.4%;

プライマリカラー
Primary colors for <Button />
--primary: 222.2 47.4% 11.2%;
--primary-foreground: 210 40% 98%;

セカンダリカラー
Secondary colors for <Button />
--secondary: 210 40% 96.1%;
--secondary-foreground: 222.2 47.4% 11.2%;

ホバーエフェクトなどのアクセントに使用されるカラー
Used for accents such as hover effects on <DropdownMenuItem>, <SelectItem>...etc
--accent: 210 40% 96.1%;
--accent-foreground: 222.2 47.4% 11.2%;

「アクセントカラー」とは、UIの中で特定の要素に対して強調するために使用されるカラーを指します。例えば、ボタンやリンクなどのアクション要素に使用されます。アクセントカラーは、Primary colorsやSecondary colorsとは異なり、UIの中で特定の要素に対して強調するために使用されるため、視覚的に目立つ色が使用されることが多いです。プロジェクトによっては、Primary colorsとSecondary colorsに加えて、アクセントカラーとして「Third colors」を定義する場合があります。

削除やキャンセルなどの破壊的なアクションに使用されるカラー
Used for destructive actions such as <Button variant="destructive">
--destructive: 0 100% 50%;
--destructive-foreground: 210 40% 98%;

フォーカスリングに使用されるカラー
Used for focus ring
--ring: 215 20.2% 65.1%;

フォーカスリングは、ユーザーがキーボードでフォーカスを移動したときに表示される、要素の周りに表示されるリング状のエフェクトです。

要素の角を丸めるために使用されるCSSプロパティ
Border radius for card, input and buttons
--radius: 0.5rem;

カード、入力フィールド、ボタンなどの要素に適用される角丸の半径

```

### 新しい色の追加

新しい色を追加するには、CSS ファイル と tailwind.config.js ファイル に追加する必要があります。

```
app/globals.css
:root {
  --warning: 38 92% 50%;
  --warning-foreground: 48 96% 89%;
}

.dark {
  --warning: 48 96% 89%;
  --warning-foreground: 38 92% 50%;
}

tailwind.config.js
module.exports = {
  theme: {
    extend: {
      colors: {
        warning: "hsl(var(--warning))",
        "warning-foreground": "hsl(var(--warning-foreground))",
      },
    },
  },
}
```

これで、↓ コンポーネントで警告ユーティリティ・クラスを使用できるようになりました。

<div className="bg-warning text-warning-foreground" />

その他のカラーフォーマット
テーマ設定には HSL カラーを使用することをお勧めしますが、お好みにより他のカラーフォーマットを使用することもできます。

rgb、rgba、または hsl カラーの使用に関する詳細は、Tailwind CSS ドキュメントを参照してください。

## ダークモード

Dark Mode - shadcn/ui

https://ui.shadcn.com/docs/dark-mode

### Create a theme provider テーマプロバイダーの作成

#### next-themes

next-themes - npm

https://www.npmjs.com/package/next-themes

デモ画面

https://next-themes-example.vercel.app/

Next.js アプリのテーマを抽象化。

- 2 行のコードで完璧なダークモードを実現
- prefers-color-scheme によるシステム設定
- カラースキームを使ったテーマブラウザ UI
- 読み込み時にフラッシュなし(SSR と SSG の両方)
- タブとウィンドウ間でテーマを同期
- テーマ変更時のフラッシュを無効化
- 特定のテーマにページを強制的に合わせる
- クラスまたはデータ属性セレクタ
- useTheme フック

インストール

npm install next-themes

touch src\components\theme-provider.tsx

#### テーマプロバイダーの作成

```components/theme-provider.tsx
"use client"

import { ThemeProvider as NextThemesProvider } from "next-themes";
import { type ThemeProviderProps } from "next-themes/dist/types";
import * as React from "react";

export function ThemeProvider({ children, ...props }: ThemeProviderProps) {
  return <NextThemesProvider {...props}>{children}</NextThemesProvider>;
}

```

#### ルートレイアウトにラップする

src\app\layout.tsx

```src\app\layout.tsx
import "@/styles/globals.css";
import { Inter } from "next/font/google";
import { ThemeProvider } from "next-themes";
import React from "react";

import type { Metadata } from "next";

const inter = Inter({ subsets: ["latin"] });

export const metadata: Metadata = {
  title: "Create Next App",
  description: "Generated by create next app",
};

export default function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <html lang="ja" suppressHydrationWarning>
      <body className={inter.className}>
        <ThemeProvider attribute="class" defaultTheme="system" enableSystem>
          {children}
        </ThemeProvider>
      </body>
    </html>
  );
}

```

※ suppressHydrationWarning は、React がクライアント側でレンダリングされたコンテンツをハイドレーションすることを抑制するために使用されます。

これで Next.js 13 App Router 使用時にダークモードを使用してもハイドレーションエラーが回避できると報告されています。

【Next.js 13】 next-themes でダークモードを実装する方法 | logsuke

https://logsuke.com/web/programming/react/next-themes

#### テーマを切り替える モードトグルを作成する

ModeTogglePage フォルダを作ります。

src\app\ModeTogglePage\page.tsx ファイルを作ります。

インストール
npx shadcn-ui@latest add dropdown-menu

```src\app\page.tsx
import Link from "next/link"

export default function Home() {
  return (
    <main>
      <h1>VNS.BLUE</h1>
      <Link href="./ButtonTestPage">ButtonTestPage</Link>
      <Link href="./ModeTogglePage">ModeTogglePage</Link>
    </main>
  )
}

```

※↑ 各機能へのリンクを追加しました。

```src\app\ModeTogglePage\page.tsx
"use client";

import { Moon, Sun } from "lucide-react";
import { useTheme } from "next-themes";
import * as React from "react";

import { Button } from "@/components/ui/button";
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuTrigger,
} from "@/components/ui/dropdown-menu";

export default function ModeToggle() {
  const { setTheme } = useTheme();

  return (
    <DropdownMenu>
      <DropdownMenuTrigger asChild>
        <Button variant="outline" size="default">
          <Sun className="h-[1.2rem] w-[1.2rem] rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0" />
          <Moon className="absolute h-[1.2rem] w-[1.2rem] rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100" />
          <span className="sr-only">Toggle theme</span>
        </Button>
      </DropdownMenuTrigger>
      <DropdownMenuContent align="end">
        <DropdownMenuItem onClick={() => setTheme("light")}>
          Light
        </DropdownMenuItem>
        <DropdownMenuItem onClick={() => setTheme("dark")}>
          Dark
        </DropdownMenuItem>
        <DropdownMenuItem onClick={() => setTheme("system")}>
          System
        </DropdownMenuItem>
      </DropdownMenuContent>
    </DropdownMenu>
  );
}

```

npm run dev

でローカルサーバーを起動して動作確認をします。

http://localhost:3000/ModeTogglePage

切り替えが確認できれば作業は完了です。

# 第２部 開発用テンプレート ＋ shadcn/ui ダークモード

第１部で調べた内容を↓このリポジトリに組み込みました。

masakinihirota/next13apptemplate

https://github.com/masakinihirota/next13apptemplate/tree/main

↓この記事の一部を切り出したものになります。

Next.js app router 開発用テンプレート (Storybook Supabase shadcn/ui) - Qiita

https://qiita.com/masakinihirota/items/3ad7a1564d2b6c56d4db


















# 第３部 ダークモードの調査

Tailwind CSS を使った ダークモード実装の効率的なアプローチ

https://zenn.dev/deer/articles/d3b104ac97711d

Tailwind CSS のダークモード対応ガイド - snappify.com

https://snappify.com/view/8d426d44-f485-4c62-9bc8-8efe23f558ea

> まとめ
> 以上を踏まえ、冒頭で紹介した CSS 変数と　カスタムカラーを使うアプローチが最適解だという結論に至りました。このアプローチは最近海外で注目を集めている shadcn/ui で知りました。 shadcn/ui をつかうとよくある変数の定義とカスタムカラーの紐付けをプロジェクトに反映することができるので興味のある方は試してみてください。

## ライブラリ next-themes について

next-themes - npm

https://www.npmjs.com/package/next-themes

## 簡単な解説

<html class="dark">

↑ このように HTML に dark クラスを追加すると、
↓ このように TailwindCSS の dark モードが有効になります。

<div className="dark:bg-darkgrey dark:text-white">

## インストール

npm install next-themes

## App Router での利用時の問題点

Next.js 13 appDir support · Issue #152 · pacocoursey/next-themes

https://github.com/pacocoursey/next-themes/issues/152

## shadcn/ui その他

### CLI

CLI - shadcn/ui

https://ui.shadcn.com/docs/cli

(実験的コマンド)

↓ 更新が利用可能なコンポーネントのリストを取得します。

npx shadcn-ui diff

↓ diff [component] コマンドで変更の確認します。

npx shadcn-ui diff alert

### タイポグラフィ 装飾の使い方

タイポグラフィ - shadcn/ui

https://ui.shadcn.com/docs/components/typography

### Figma

@shadcn/ui - Design System – Figma

https://www.figma.com/community/file/1203061493325953101

### 変更履歴

Changelog - shadcn/ui

https://ui.shadcn.com/docs/changelog

例
ベースカラー
gray
neutral
slate
stone
zinc

# shadcn/ui の読み方は？

作者本人のツィート

https://twitter.com/shadcn/status/1647397488742080512

> @shadcn how do i properly pronounce your handle when i'm introducing your projects to others 😅 been saying "shad-see-enn" but idk if that's correct

@shadcn 他の人にあなたのプロジェクトを紹介するとき、あなたのハンドルネームをどう発音すればいいのでしょうか？

> shad as in shadow

シャドウ

シャドウ ユーアイ
シャドウ ユーザーインターフェース

# 参考

【Next.js 13】 next-themes でダークモードを実装する方法 | logsuke

https://logsuke.com/web/programming/react/next-themes

※この記事には、ハイドレーションエラー対策があります。

Next × Stitches × next-themes を使用してダークモード実装

https://zenn.dev/hiro4hiro4/articles/e90778a816df84

Tailwind CSS を使った ダークモード実装の効率的なアプローチ

https://zenn.dev/deer/articles/d3b104ac97711d






























































































----------------------------------------
----------------------------------------







●●●●●●●●●●●●●●●●●●●●●●●
●●●●●●●●●●●●●●●●●●●●●●●





●●●●●●●●●●●●●●●●●●●●●●●
●●●●●●●●●●●●●●●●●●●●●●●





●●●●●●●●●●●●●●●●●●●●●●●
●●●●●●●●●●●●●●●●●●●●●●●





●●●●●●●●●●●●●●●●●●●●●●●
●●●●●●●●●●●●●●●●●●●●●●●





●●●●●●●●●●●●●●●●●●●●●●●
●●●●●●●●●●●●●●●●●●●●●●●





●●●●●●●●●●●●●●●●●●●●●●●
●●●●●●●●●●●●●●●●●●●●●●●





●●●●●●●●●●●●●●●●●●●●●●●
●●●●●●●●●●●●●●●●●●●●●●●





●●●●●●●●●●●●●●●●●●●●●●●
●●●●●●●●●●●●●●●●●●●●●●●





●●●●●●●●●●●●●●●●●●●●●●●
●●●●●●●●●●●●●●●●●●●●●●●





●●●●●●●●●●●●●●●●●●●●●●●
●●●●●●●●●●●●●●●●●●●●●●●





●●●●●●●●●●●●●●●●●●●●●●●
●●●●●●●●●●●●●●●●●●●●●●●





●●●●●●●●●●●●●●●●●●●●●●●
●●●●●●●●●●●●●●●●●●●●●●●





●●●●●●●●●●●●●●●●●●●●●●●
●●●●●●●●●●●●●●●●●●●●●●●





●●●●●●●●●●●●●●●●●●●●●●●
●●●●●●●●●●●●●●●●●●●●●●●





●●●●●●●●●●●●●●●●●●●●●●●
●●●●●●●●●●●●●●●●●●●●●●●





●●●●●●●●●●●●●●●●●●●●●●●
●●●●●●●●●●●●●●●●●●●●●●●





●●●●●●●●●●●●●●●●●●●●●●●
●●●●●●●●●●●●●●●●●●●●●●●





●●●●●●●●●●●●●●●●●●●●●●●
●●●●●●●●●●●●●●●●●●●●●●●





●●●●●●●●●●●●●●●●●●●●●●●
●●●●●●●●●●●●●●●●●●●●●●●





●●●●●●●●●●●●●●●●●●●●●●●
●●●●●●●●●●●●●●●●●●●●●●●



